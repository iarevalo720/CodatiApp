<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="UI.Views.Taller.T_informe"
             Title="Informes">
    <ContentPage.Resources>
        <ResourceDictionary>
            <Style TargetType="Label">
                <Setter Property="FontSize" Value="16" />
            </Style>
            <Style TargetType="Button">
                <Setter Property="FontSize" Value="16" />
                <Setter Property="HeightRequest" Value="50" />
                <Setter Property="Margin" Value="0,10,0,0" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="10" MaximumWidthRequest="900">
            <Label Text="Generar Informe de Órdenes" 
                   FontSize="20" 
                   FontAttributes="Bold" 
                   HorizontalOptions="Center" 
                   Margin="0,0,0,20" />

            <!-- Selectores de fecha -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                <VerticalStackLayout Grid.Column="0">
                    <Label Text="Fecha Inicio" FontAttributes="Bold" />
                    <DatePicker Date="{Binding FechaInicio}" />
                </VerticalStackLayout>

                <VerticalStackLayout Grid.Column="1">
                    <Label Text="Fecha Fin" FontAttributes="Bold" />
                    <DatePicker Date="{Binding FechaFin}" />
                </VerticalStackLayout>
            </Grid>

            <Button Text="Generar Informe" 
                    Command="{Binding GenerarInformeCommand}"
                    IsEnabled="{Binding IsNoBusy}" />

            <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" />

            <!-- Resultados -->
            <VerticalStackLayout IsVisible="{Binding MostrarResultados}" Spacing="15">
                <Frame BackgroundColor="#111">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Resumen de Órdenes" FontAttributes="Bold" FontSize="18" />

                        <Grid ColumnDefinitions="*,*"
                              RowDefinitions="auto,auto,auto, auto">
                            <Label Text="Total de Órdenes:" Grid.Column="0" Grid.Row="0" Margin="0, 0, 0, 20"/>
                            <Label Text="{Binding TotalOrdenes}" Grid.Column="1" FontAttributes="Bold" Grid.Row="0"/>

                            <Label Text="Órdenes Rechazadas:" Grid.Column="0" Grid.Row="1"/>
                            <Label Text="{Binding OrdenesRechazadas}" Grid.Column="1" FontAttributes="Bold" Grid.Row="1"/>

                            <Label Text="Órdenes en Proceso:" Grid.Column="0" Grid.Row="2"/>
                            <Label Text="{Binding OrdenesEnProceso}" Grid.Column="1" Grid.Row="2" FontAttributes="Bold"/>

                            <Label Text="Órdenes Finalizadas:" Grid.Column="0" Grid.Row="3" />
                            <Label Text="{Binding OrdenesFinalizadas}" Grid.Column="1" Grid.Row="3" FontAttributes="Bold" />
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <Label Text="Servicios Más Solicitados" FontAttributes="Bold" FontSize="18" />

                <ListView ItemsSource="{Binding ServiciosMasSolicitados}"
                          HasUnevenRows="True"
                          IsVisible="{Binding MostrarResultados}">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <ViewCell>
                                <Frame Margin="5" Padding="10">
                                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                                        <Label Text="{Binding Servicio}"
                                               FontSize="16"
                                               VerticalOptions="Center"/>
                                        <Label Text="{Binding Frecuencia, StringFormat='{0} veces'}" 
                                               Grid.Column="1"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               VerticalOptions="Center"
                                               HorizontalOptions="End"/>
                                    </Grid>
                                </Frame>
                            </ViewCell>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </VerticalStackLayout>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>